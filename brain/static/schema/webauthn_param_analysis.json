{
    "type": "object",
    "title": "WebAuthn Parameter Analysis",
    "properties": {
        "scan_config": {
            "type": "object",
            "title": "Scan Configuration",
            "oneOf": [
                {
                    "title": "Scan on a single domain",
                    "properties": {
                        "scan_id": {
                            "type": "string",
                            "required": true,
                            "default": "",
                            "options": {
                                "hidden": true
                            }
                        },
                        "scan_type": {
                            "type": "string",
                            "required": true,
                            "enum": [
                                "single"
                            ],
                            "options": {
                                "hidden": true
                            }
                        },
                        "domain": {
                            "type": "string",
                            "required": true,
                            "title": "Domain"
                        }
                    }
                },
                {
                    "title": "Scan on a range of domains",
                    "properties": {
                        "scan_id": {
                            "type": "string",
                            "required": true,
                            "default": "",
                            "options": {
                                "hidden": true
                            }
                        },
                        "scan_type": {
                            "type": "string",
                            "required": true,
                            "enum": [
                                "range"
                            ],
                            "options": {
                                "hidden": true
                            }
                        },
                        "list_id": {
                            "type": "string",
                            "required": true,
                            "title": "List ID"
                        },
                        "offset": {
                            "type": "integer",
                            "required": true,
                            "default": 1,
                            "title": "Offset"
                        },
                        "limit": {
                            "type": "integer",
                            "required": true,
                            "default": 100,
                            "title": "Limit"
                        }
                    }
                },
                {
                    "title": "Scan on a ground truth",
                    "properties": {
                        "scan_id": {
                            "type": "string",
                            "required": true,
                            "default": "",
                            "options": {
                                "hidden": true
                            }
                        },
                        "scan_type": {
                            "type": "string",
                            "required": true,
                            "enum": [
                                "ground-truth"
                            ],
                            "options": {
                                "hidden": true
                            }
                        },
                        "gt_id": {
                            "type": "string",
                            "required": true,
                            "title": "Ground Truth ID"
                        },
                        "offset": {
                            "type": "integer",
                            "required": true,
                            "default": 1,
                            "title": "Offset"
                        },
                        "limit": {
                            "type": "integer",
                            "required": true,
                            "default": 1000,
                            "title": "Limit"
                        }
                    }
                },
                {
                    "title": "Rescan login pages from prior scan or latest",
                    "properties": {
                        "scan_id": {
                            "type": "string",
                            "required": true,
                            "default": "",
                            "options": {
                                "hidden": true
                            }
                        },
                        "scan_type": {
                            "type": "string",
                            "required": true,
                            "enum": [
                                "rescan-login-pages"
                            ],
                            "options": {
                                "hidden": true
                            }
                        },
                        "reference_scan_id": {
                            "type": "string",
                            "required": true,
                            "title": "Reference scan id or 'latest'"
                        }
                    }
                }
            ]
        },
        "webauthn_param_analysis_config": {
            "type": "object",
            "title": "WebAuthn Parameter Analysis Configuration",
            "properties": {
                "browser_config": {
                    "type": "object",
                    "required": true,
                    "title": "Browser Configuration",
                    "properties": {
                        "name": {
                            "type": "string",
                            "required": true,
                            "title": "Browser",
                            "default": "CHROMIUM",
                            "enum": [
                                "CHROMIUM"
                            ]
                        },
                        "width": {
                            "type": "integer",
                            "required": true,
                            "default": 1920,
                            "title": "Width of Browser Window"
                        },
                        "height": {
                            "type": "integer",
                            "required": true,
                            "default": 1080,
                            "title": "Height of Browser Window"
                        },
                        "user_agent": {
                            "type": "string",
                            "required": true,
                            "default": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36",
                            "title": "User Agent"
                        },
                        "headless": {
                            "type": "boolean",
                            "required": true,
                            "default": true,
                            "title": "Headless Mode"
                        },
                        "locale": {
                            "type": "string",
                            "required": true,
                            "default": "en-GB",
                            "title": "Locale"
                        },
                        "timeout_default": {
                            "type": "number",
                            "required": true,
                            "default": 30,
                            "title": "Timeout for playwright (in seconds)"
                        }
                    }
                },
                "login_page_config": {
                    "type": "object",
                    "required": true,
                    "title": "Login Page Configuration",
                    "description": "Uses same login page detection as Landscape analysis",
                    "properties": {
                        "login_page_strategy_scope": {
                            "type": "array",
                            "required": true,
                            "title": "In-Scope Login Page Strategies",
                            "default": [
                                "PATHS",
                                "CRAWLING",
                                "METASEARCH",
                                "SITEMAP",
                                "HOMEPAGE"
                            ],
                            "items": {
                                "type": "string",
                                "enum": [
                                    "PATHS",
                                    "CRAWLING",
                                    "METASEARCH",
                                    "HOMEPAGE",
                                    "SITEMAP",
                                    "ROBOTS",
                                    "MANUAL"
                                ]
                            }
                        },
                        "login_page_url_regexes": {
                            "type": "array",
                            "required": true,
                            "title": "Prioritized Login Page URL Regexes",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "regex": {
                                        "type": "string",
                                        "required": true,
                                        "title": "Regex"
                                    },
                                    "priority": {
                                        "type": "integer",
                                        "required": true,
                                        "title": "Priority",
                                        "minimum": 0,
                                        "maximum": 100
                                    }
                                }
                            },
                            "default": []
                        },
                        "manual_strategy_config": {
                            "type": "object",
                            "required": false,
                            "title": "Manual Strategy Configuration",
                            "properties": {
                                "login_page_candidates": {
                                    "type": "array",
                                    "required": true,
                                    "default": [],
                                    "title": "Manually specified Login Page Candidates",
                                    "items": {
                                        "type": "string"
                                    }
                                }
                            }
                        },
                        "paths_strategy_config": {
                            "type": "object",
                            "required": false,
                            "title": "Paths Strategy Configuration",
                            "properties": {
                                "paths": {
                                    "type": "array",
                                    "required": true,
                                    "title": "Paths",
                                    "items": {
                                        "type": "string"
                                    },
                                    "default": [
                                        "/login",
                                        "/signin",
                                        "/account/login",
                                        "/auth"
                                    ]
                                },
                                "subdomains": {
                                    "type": "array",
                                    "required": true,
                                    "title": "Subdomains",
                                    "items": {
                                        "type": "string"
                                    },
                                    "default": [
                                        "login",
                                        "signin",
                                        "account"
                                    ]
                                }
                            }
                        },
                        "crawling_strategy_config": {
                            "type": "object",
                            "required": false,
                            "title": "Crawling Strategy Configuration",
                            "properties": {
                                "max_anchor_candidates": {
                                    "type": "integer",
                                    "required": true,
                                    "title": "Maximum number of login page candidates for anchor hrefs",
                                    "default": 1
                                },
                                "max_element_candidates": {
                                    "type": "integer",
                                    "required": true,
                                    "title": "Maximum number of login page candidates for any elements",
                                    "default": 1
                                },
                                "max_elements_to_click": {
                                    "type": "integer",
                                    "required": true,
                                    "title": "Maximum number of elements to click",
                                    "default": 10
                                }
                            }
                        },
                        "sitemap_strategy_config": {
                            "type": "object",
                            "required": false,
                            "title": "Sitemap Strategy Configuration",
                            "properties": {
                                "max_candidates": {
                                    "type": "integer",
                                    "required": true,
                                    "title": "Maximum number of login page candidates",
                                    "default": 1
                                },
                                "max_recursion_level": {
                                    "type": "integer",
                                    "required": true,
                                    "title": "Maximum recursion level of sitemaps",
                                    "default": 0
                                },
                                "max_sitemap_size": {
                                    "type": "integer",
                                    "required": true,
                                    "title": "Maximum size of sitemap (in bytes)",
                                    "default": 50000000
                                },
                                "timeout_fetch_sitemap": {
                                    "type": "number",
                                    "required": true,
                                    "title": "Timeout to fetch sitemap (in seconds)",
                                    "default": 10
                                }
                            }
                        },
                        "robots_strategy_config": {
                            "type": "object",
                            "required": false,
                            "title": "Robots Strategy Configuration",
                            "properties": {
                                "max_candidates": {
                                    "type": "integer",
                                    "required": true,
                                    "title": "Maximum number of login page candidates",
                                    "default": 1
                                },
                                "timeout_fetch_robots": {
                                    "type": "number",
                                    "required": true,
                                    "title": "Timeout to fetch robots.txt (in seconds)",
                                    "default": 10
                                }
                            }
                        },
                        "metasearch_strategy_config": {
                            "type": "object",
                            "required": false,
                            "title": "Metasearch Strategy Configuration",
                            "properties": {
                                "search_term": {
                                    "type": "string",
                                    "required": true,
                                    "default": "%s login",
                                    "title": "Search Term"
                                },
                                "max_candidates": {
                                    "type": "integer",
                                    "required": true,
                                    "title": "Maximum number of login page candidates",
                                    "default": 1
                                }
                            }
                        }
                    }
                },
                "webauthn_detection_config": {
                    "type": "object",
                    "required": true,
                    "title": "WebAuthn Detection Configuration",
                    "properties": {
                        "wait_time": {
                            "type": "number",
                            "required": true,
                            "title": "Wait Time (seconds)",
                            "default": 5,
                            "description": "Time to wait for WebAuthn calls after page load"
                        },
                        "max_interactions": {
                            "type": "number",
                            "required": true,
                            "title": "Max Interactions",
                            "default": 3,
                            "description": "Maximum number of button clicks to attempt"
                        }
                    }
                },
                "artifacts_config": {
                    "type": "object",
                    "required": true,
                    "title": "Artifacts Configuration",
                    "properties": {
                        "store_webauthn_screenshot": {
                            "type": "boolean",
                            "required": true,
                            "default": true,
                            "title": "Store screenshot of WebAuthn detection"
                        },
                        "store_webauthn_har": {
                            "type": "boolean",
                            "required": true,
                            "default": true,
                            "title": "Store HTTP traffic in HAR"
                        }
                    }
                }
            }
        }
    }
}
